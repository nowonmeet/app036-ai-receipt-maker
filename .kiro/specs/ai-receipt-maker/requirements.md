# 要件定義書

## 概要

AI Receipt Makerは、DALL-Eを使用してAI生成レシート画像を作成するiOSアプリです。ユーザーは店名、商品名、金額を指定してカスタムレシートを生成でき、生成された画像はアプリ内に安全に保存されます。無料ユーザーには透かし付きで画像保存が可能で、有料サブスクリプションユーザーは透かしなしで保存できます。RevenueCatを使用したサブスクリプション管理と、Swift Dataによるデータ永続化を実装します。

## 要件

### 要件 1

**ユーザーストーリー:** ユーザーとして、DALL-Eを使用してAIレシート画像を生成したい。様々な目的でリアルなレシートを作成できるようにするため。

#### 受け入れ基準

1. ユーザーが生成ボタンをタップしたとき、システムはDALL-E APIを呼び出してレシート画像を生成する
2. 指定なしで生成するとき、システムはプレースホルダーの店名、商品、金額でランダムなレシートを作成する
3. ユーザーが店名、商品名、金額を指定したとき、システムはこれらの詳細を生成されるレシートに組み込む
4. レシートを生成するとき、システムはユーザーの地域設定に基づいてローカル通貨形式を使用する
5. API呼び出しが失敗したとき、システムは適切なエラーメッセージをユーザーに表示する

### 要件 2

**ユーザーストーリー:** ユーザーとして、カスタムの店舗情報と購入詳細を入力したい。パーソナライズされたレシートを生成できるようにするため。

#### 受け入れ基準

1. ユーザーが入力フォームを開いたとき、システムは店名、商品名、金額のフィールドを表示する
2. ユーザーがフィールドを空のままにしたとき、システムはランダムな値で生成を許可する
3. ユーザーが金額を入力したとき、システムはユーザーの地域通貨設定に従ってフォーマットする
4. ユーザーがフォームを送信したとき、システムは入力を検証して生成を進める
5. ユーザーが無効なデータを入力した場合、システムは検証エラーを表示する

### 要件 3

**ユーザーストーリー:** ユーザーとして、生成された画像をアプリ内に安全に保存したい。アプリ外から簡単にアクセスできないようにするため。

#### 受け入れ基準

1. 画像が生成されたとき、システムはSwift Dataを使用してアプリのプライベートドキュメントディレクトリに保存する
2. 画像を保存するとき、システムは簡単に発見されないよう安全なファイル名を使用する
3. アプリが削除されたとき、システムは保存されたすべての画像がアプリと一緒に削除されることを保証する
4. 保存された画像を表示するとき、システムは安全な保存場所からそれらを読み込む
5. ユーザーが保存された画像を表示するとき、システムはアプリ内のギャラリーインターフェースでそれらを表示する

### 要件 4

**ユーザーストーリー:** 無料ユーザーとして、生成された画像を透かし付きでデバイスに保存したい。アプリの制限を理解しながら使用できるようにするため。

#### 受け入れ基準

1. 無料ユーザーが画像をデバイスに保存するとき、システムは大きな「AI RECEIPT MAKER」透かしを追加する
2. 透かしを適用するとき、システムはそれを明確に見えるようにするが、レシートの内容を完全に隠さないようにする
3. ユーザーが保存を確認したとき、システムは透かし付きの画像をデバイスのフォトライブラリに保存する
4. 保存が失敗したとき、システムは適切なエラーメッセージを表示する
5. ユーザーがフォトライブラリの許可を与えていないとき、システムは保存前に許可を要求する

### 要件 5

**ユーザーストーリー:** プレミアムユーザーとして、生成された画像を透かしなしで保存したい。クリーンなレシート画像を使用できるようにするため。

#### 受け入れ基準

1. プレミアムユーザーが画像を保存するとき、システムは透かしなしの元の画像を保存する
2. ユーザーステータスを判定するとき、システムはRevenueCat経由で現在のサブスクリプションステータスを確認する
3. プレミアムユーザーのサブスクリプションが期限切れになったとき、システムは透かし付き保存に戻る
4. プレミアムユーザーとして保存するとき、システムはクリーンな画像をデバイスのフォトライブラリに保存する
5. サブスクリプションステータスの確認が失敗した場合、システムはデフォルトで透かし付き保存にする

### 要件 6

**ユーザーストーリー:** ユーザーとして、RevenueCatのペイウォールを通じてサブスクリプションを管理したい。プレミアム機能にアップグレードできるようにするため。

#### 受け入れ基準

1. ユーザーがサブスクリプションなしでプレミアム機能にアクセスしたとき、システムはRevenueCatの公式ペイウォールビューを表示する
2. ユーザーが購入を完了したとき、システムは即座にサブスクリプションステータスを更新する
3. アプリが起動したとき、システムはRevenueCatとサブスクリプションステータスを同期する
4. サブスクリプションステータスが変更されたとき、システムは現在の権限を反映するようUIを更新する
5. ペイウォールが購入なしで閉じられたとき、システムは前の画面に戻る

### 要件 7

**ユーザーストーリー:** 無料ユーザーとして、生涯最大2回まで画像を生成したい。アプリの機能を試用できるようにするため。

#### 受け入れ基準

1. 無料ユーザーが画像生成を試みるとき、システムは生涯の使用回数をチェックする
2. 無料ユーザーが生涯2回の生成に達したとき、システムは試用期間終了メッセージを表示してペイウォールを表示する
3. 無料ユーザーの使用回数は日付が変わってもリセットされない
4. 使用量を追跡するとき、システムはSwift Dataを使用して生涯の生成回数を保存する
5. ユーザーがプレミアムにアップグレードしたとき、システムは即座に日次10回の制限に切り替える

### 要件 8

**ユーザーストーリー:** プレミアムユーザーとして、1日最大10回まで画像を生成したい。アプリの使用により柔軟性を持たせるため。

#### 受け入れ基準

1. プレミアムユーザーが画像生成を試みるとき、システムはプレミアム制限に対して1日の使用回数をチェックする
2. プレミアムユーザーがその日の10回の生成に達したとき、システムはプレミアム使用制限メッセージを表示する
3. 新しい日が始まったとき、システムはプレミアムユーザーの生成回数を0にリセットする
4. プレミアムユーザーのサブスクリプションが期限切れになったとき、システムは即座に無料ユーザー制限を適用する
5. 制限をチェックするとき、システムは制限を適用する前に現在のサブスクリプションステータスを確認する

### 要件 9

**ユーザーストーリー:** どの地域のユーザーとしても、レシートに地域の通貨形式で金額を表示したい。生成されるレシートが自分の地域で本物らしく見えるようにするため。

#### 受け入れ基準

1. レシートを生成するとき、システムはユーザーの現在のロケール設定を検出する
2. 通貨金額をフォーマットするとき、システムはユーザーの地域に適した通貨記号と形式を使用する
3. ユーザーが米国にいるとき、システムは金額をUSD形式でフォーマットする（例：$12.99）
4. ユーザーがヨーロッパにいるとき、システムはユーロ形式を使用して金額をフォーマットする（例：€12,99）
5. ユーザーが日本にいるとき、システムは金額をJPY形式でフォーマットする（例：¥1,299）
6. ロケールが判定できないとき、システムはデフォルトでUSD形式にする

### 要件 10

**ユーザーストーリー:** ユーザーとして、すべてのアプリインターフェースのテキストを英語で表示したい。米国市場でアプリを効果的に使用できるようにするため。

#### 受け入れ基準

1. アプリが起動したとき、システムはデバイスの言語設定に関係なくすべてのUIテキストを英語で表示する
2. エラーメッセージを表示するとき、システムはそれらを英語で表示する
3. サブスクリプション情報を表示するとき、システムはそれを英語で提示する
4. 使用制限を表示するとき、システムはメッセージを英語で表示する
5. ユーザーがアプリの機能と対話するとき、システムは英語でフィードバックを提供する